<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Registration Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- QR Code Section (for teacher) -->
    <div id="qrCodeSection" class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white p-8 sm:p-12 rounded-xl shadow-2xl w-full max-w-sm mx-auto text-center">
            <h2 class="text-2xl font-bold mb-2 text-gray-800">Scan Me</h2>
            <p class="text-gray-500 mb-6 text-sm">Open your phone's camera and scan the QR code to register.</p>
            <div class="flex justify-center items-center mb-6">
            </div>
            <div class="mt-6 flex items-center justify-between">
                <hr class="w-1/3 border-t border-gray-300">
                <span class="text-sm text-gray-400 font-medium">OR</span>
                <hr class="w-1/3 border-t border-gray-300">
            </div>
            <button id="continueBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg transition-colors shadow-md mt-6">
                Continue to Form
            </button>
        </div>
    </div>

    <!-- Registration Form Section -->
    <div id="registrationFormSection" class="hidden flex items-center justify-center min-h-screen p-4">
        <div class="bg-white p-8 sm:p-12 rounded-lg shadow-xl w-full max-w-md mx-auto">
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">Student Registration Form</h2>
            <form id="registrationForm" class="space-y-6">
                <div>
                    <label for="regNumber" class="block text-sm font-medium text-gray-700 mb-1">Registration Number</label>
                    <input type="text" id="regNumber" name="regNumber" placeholder="Enter Your Register Number..." class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input type="text" id="name" name="name" placeholder="Enter Your Name..." class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="email" name="email" placeholder="Enter Your Email..." class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500">
                </div>
                <div>
                    <label for="branch" class="block text-sm font-medium text-gray-700 mb-1">Branch</label>
                    <select id="branch" name="branch" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 bg-white text-gray-500">
                        <option value="">--Select Branch--</option>
                        <option value="cs">Computer Science</option>
                        <option value="ee">Electrical Engineering</option>
                        <option value="me">Mechanical Engineering</option>
                        <option value="ce">Civil Engineering</option>
                    </select>
                </div>
                <div>
                    <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-semibold text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                        Submit
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Student Portal Section (Initially Hidden) -->
    <div id="studentPortalSection" class="hidden min-h-screen">
        <header class="bg-white shadow-sm py-4">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-600">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.12a2.25 2.25 0 01-2.25 2.25H9.75A2.25 2.25 0 017.5 19.12V16.5A2.25 2.25 0 019.75 14.25h2.5A2.25 2.25 0 0115 16.5v2.62zm-6.75-6.75a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0z" />
                    </svg>
                    <span class="text-xl font-semibold text-gray-800">Student Self-Attendance Portal</span>
                </div>
                <div class="flex items-center space-x-4 text-sm text-gray-500">
                    <span id="currentDate"></span>
                    <span id="currentTime"></span>
                    <div class="flex items-center space-x-1">
                        <span>Student:</span>
                        <span id="studentNameDisplay" class="font-medium text-gray-700"></span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                            <path fill-rule="evenodd" d="M5.22 8.78a.75.75 0 011.06-.02L10 12.19l3.72-3.43a.75.75 0 111.04 1.08l-4.25 3.9a.75.75 0 01-1.04 0l-4.25-3.9a.75.75 0 01-.02-1.06z" clip-rule="evenodd" />
                        </svg>
                    </div>
                </div>
            </div>
        </header>

        <main class="container mx-auto mt-8 p-4">
            <!-- Mark Presence Card -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h3 class="text-lg font-semibold text-center mb-4">Mark Your Presence</h3>
                <div id="markAttendance" class="flex justify-center">
                    <button id="markAttendanceBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-6 rounded-md shadow-lg transition-colors">
                        Mark My Attendance for Today
                    </button>
                </div>
                <div id="attendanceStatus" class="hidden">
                    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-md mt-4" role="alert">
                        <strong class="font-bold">Attendance Marked Today at <span id="attendanceTime"></span></strong>
                        <span class="block sm:inline mt-2 sm:mt-0">You are all set. Have a great day!</span>
                    </div>
                </div>
            </div>

            <!-- Attendance Summary Card -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">Your Attendance Summary</h3>
                <div class="flex items-center justify-between text-gray-800">
                    <span class="text-sm">Overall Percentage:</span>
                    <span id="attendancePercentage" class="text-2xl font-bold text-green-500">85%</span>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script>
        // Check for a QR code specific parameter in the URL (e.g., ?teacher=true)
        const urlParams = new URLSearchParams(window.location.search);
        const isTeacherMode = urlParams.get('teacher') === 'true';

        // Function to switch to the registration form
        function switchToRegistrationForm() {
            document.getElementById('qrCodeSection').classList.add('hidden');
            document.getElementById('qrCodeSection').classList.remove('flex');
            document.getElementById('registrationFormSection').classList.add('flex');
            document.getElementById('registrationFormSection').classList.remove('hidden');
        }

        // Check if in "teacher" mode, otherwise show the QR code and continue button
        if (isTeacherMode) {
            document.getElementById('qrCodeSection').classList.add('flex');
            document.getElementById('qrCodeSection').classList.remove('hidden');
            document.getElementById('registrationFormSection').classList.add('hidden');
            document.getElementById('registrationFormSection').classList.remove('flex');
            document.getElementById('continueBtn').classList.add('hidden'); // Hide the button in teacher mode
            generateNewQRCode();
        } else {
            document.getElementById('qrCodeSection').classList.add('flex');
            document.getElementById('qrCodeSection').classList.remove('hidden');
            document.getElementById('registrationFormSection').classList.add('hidden');
            document.getElementById('registrationFormSection').classList.remove('flex');
            generateNewQRCode();
        }

        // Add event listener to the continue button
        document.getElementById('continueBtn').addEventListener('click', switchToRegistrationForm);

        document.getElementById('registrationForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission

            const regNumber = document.getElementById('regNumber').value;
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const branch = document.getElementById('branch').value;

            // Simple validation
            if (regNumber && name && email && branch) {
                // Here you would typically send the data to a server
                // and then redirect on success. For this example, we'll
                // just show the new page.

                // Hide the registration form
                document.getElementById('registrationFormSection').classList.add('hidden');
                
                // Show the student portal
                const portalSection = document.getElementById('studentPortalSection');
                portalSection.classList.remove('hidden');

                // Update the student's name on the portal
                document.getElementById('studentNameDisplay').textContent = name;

                // Display current date and time
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
                document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                // A custom message box instead of alert()
                const messageBox = document.createElement('div');
                messageBox.innerHTML = `
                    <div class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
                            <h3 class="text-lg font-bold mb-4">Success!</h3>
                            <p class="text-gray-700 mb-6">Form submitted successfully. Redirecting to your portal.</p>
                            <button onclick="this.closest('.fixed').remove()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors">OK</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(messageBox);

            } else {
                // A custom message box for validation failure
                const messageBox = document.createElement('div');
                messageBox.innerHTML = `
                    <div class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full text-center">
                            <h3 class="text-lg font-bold mb-4">Error</h3>
                            <p class="text-red-500 mb-6">Please fill out all the fields.</p>
                            <button onclick="this.closest('.fixed').remove()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors">OK</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(messageBox);
            }
        });

        document.getElementById('markAttendanceBtn').addEventListener('click', function() {
            // Get current time
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

            // Hide the button
            this.classList.add('hidden');

            // Show the success message and update the time
            const attendanceStatus = document.getElementById('attendanceStatus');
            attendanceStatus.classList.remove('hidden');
            document.getElementById('attendanceTime').textContent = timeString;
        });

        // QR Code Generation Logic
        function generateNewQRCode() {
            const qrCodeElement = document.getElementById('qrcode');
            qrCodeElement.innerHTML = ''; // Clear existing QR code

            // The data to be encoded in the QR code: a unique URL
            const urlForQr = window.location.protocol + "//" + window.location.host + window.location.pathname;
            
            new QRCode(qrCodeElement, {
                text: urlForQr,
                width: 256,
                height: 256,
            });
        }

        // Generate the QR code on page load
        generateNewQRCode();
    </script>
</body>
</html>
